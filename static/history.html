<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction History</title>
    <style>
    
        body { font-family: Arial, sans-serif; background: #f1f8e9; text-align: center; padding: 40px; }
        h2 { color: #1a2980; }
        table { width: 80%; margin: 20px auto; border-collapse: collapse; background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-radius: 12px; overflow: hidden; }
        th, td { padding: 15px; border-bottom: 1px solid #ddd; text-align: center; }
        th { background: #1a2980; color: white; }
        tr:hover { background: #f5f5f5; }
        .back-btn { display: inline-block; margin-top: 20px; padding: 10px 20px; background: #1a2980; color: white; text-decoration: none; border-radius: 8px; }
    </style>
</head>
<body>

    <h2>Transaction History</h2>

    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Amount</th>
            </tr>
        </thead>
        <tbody id="historyTable">
            </tbody>
    </table>

    <a href="dashboard.html" class="back-btn">Back to Dashboard</a>

    <script>
        async function fetchHistory() {
            const token = localStorage.getItem('authToken');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            try {
                const response = await fetch('/api/transactions/history', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                const tableBody = document.getElementById('historyTable');
                tableBody.innerHTML = "";

                if (response.ok) {
                    data.forEach(tr => {
                        
                        const dateObj = new Date(tr.date);
                        const formattedDate = dateObj.toLocaleString('en-GB', {
                            day: '2-digit',
                            month: 'short',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });

                        const row = `<tr>
                            <td>${formattedDate}</td>
                            <td>${tr.type}</td>
                            <td>TK ${parseFloat(tr.amount).toFixed(2)}</td>
                        </tr>`;
                        tableBody.innerHTML += row;
                    });
                } else {
                    alert("Error fetching history: " + data.message);
                }
            } catch (error) {
                console.error("Fetch error:", error);
            }
        }

        fetchHistory();
    </script>
</body>
</html>
